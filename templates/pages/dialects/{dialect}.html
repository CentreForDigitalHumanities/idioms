{% extends "page_base.html" %}

{% set answerset_row = sql("SELECT answerset_id, answerset_name, answerset_description FROM answerset WHERE answerset_id = :answerset_id", {"answerset_id": dialect}) %}

{% block title %}Dialect {% endblock %}

{% block content %}

{% if answerset_row %}
    {% set dialect_id = answerset_row[0].answerset_id %}
    {% set dialect_source = sql("SELECT value_text FROM answerset_data WHERE answerset = :answerset_id AND parameter_definition_id = 'Source1'", {"answerset_id": dialect_id})[0][0] %}

    <h1 class="title is-1">{{ answerset_row[0].answerset_name }}</h1>

        <h2 class="title is-2">Custom Properties</h2>

        <dl>
            <div>
                <dt>Principal location</dt>
                <dd>{{ answerset_row[0].answerset_description }}</dd>
            </div>
            <div>
                <dt>Source</dt>
                <dd>{{ dialect_source }}</dd>
            </div>
        </dl>

    <h2 class="title is-2"><a href="/dialects/{{ dialect }}/sentences">Manipulations</a></h2>

    <h2 class="title is-2">Idioms</h2>
    <p>
        {{ sql("SELECT count(*) as cnt FROM strategy WHERE strategy_answerset_id = :dialect_id", {"dialect_id": dialect_id})[0].cnt }} records found.
    </p>

    <table class="table is-striped is-hoverable is-fullwidth">
        <thead>
            <tr>
                <th></div>
                <th>Idiom</th>
                <th>Meaning</th>
                <th>Number of properties</th>
            </tr>
        </thead>
        <tbody>
        {% for idiom in sql("""SELECT ROW_NUMBER() OVER (ORDER BY strategy_name ASC) AS row_num,
                                strategy_id, strategy_name, strategy_description, strategy_answerset_id,
                                COUNT(sd.strategy_data_id) AS properties_cnt
                            FROM strategy s
                            JOIN strategy_data sd ON sd.strategy = s.strategy_id
                            WHERE strategy_answerset_id = :dialect_id
                            GROUP BY strategy_id
                            ORDER BY strategy_name ASC;
                            """, {"dialect_id": dialect_id}) %}
        <tr>
            <td>{{ idiom.row_num }}</td>
            <td><a href="/idioms/{{ idiom.strategy_id }}">{{ idiom.strategy_name }}</a></td>
            <td>{{ idiom.strategy_description }}</td>
            <td>{{ idiom.properties_cnt }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
{% else %}
    {{ raise_404("Dialect not found") }}
{% endif %}

{% endblock %}
